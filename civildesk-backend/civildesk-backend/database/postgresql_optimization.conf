# =============================================================================
# POSTGRESQL OPTIMIZATION CONFIGURATION
# Civildesk Employee Management System
# Phase 2 Optimization - December 2025
# =============================================================================
# 
# INSTRUCTIONS:
# 1. Backup your current postgresql.conf
# 2. Copy these settings to postgresql.conf or create a conf.d file
# 3. Adjust values based on your available RAM (see comments below)
# 4. Restart PostgreSQL: sudo systemctl restart postgresql
# 5. Verify settings: psql -U postgres -c "SHOW shared_buffers;"
#
# REFERENCE:
# - For 2GB RAM server: Use "Small" values
# - For 4GB RAM server: Use "Medium" values  
# - For 8GB+ RAM server: Use "Production" values
# =============================================================================

# =============================================================================
# MEMORY SETTINGS
# =============================================================================

# shared_buffers: RAM dedicated to PostgreSQL for caching
# Rule: 25% of total RAM
# Small (2GB): 512MB | Medium (4GB): 1GB | Production (8GB+): 2GB
shared_buffers = 512MB

# effective_cache_size: Estimate of memory available for disk caching
# Rule: 50-75% of total RAM
# Small (2GB): 1GB | Medium (4GB): 3GB | Production (8GB+): 6GB
effective_cache_size = 1GB

# work_mem: Memory for each sort/hash operation (per query)
# Be careful - this is per operation, not per query!
# Small: 8MB | Medium: 16MB | Production: 32MB
work_mem = 8MB

# maintenance_work_mem: Memory for VACUUM, CREATE INDEX, etc.
# Small: 64MB | Medium: 256MB | Production: 512MB
maintenance_work_mem = 64MB

# =============================================================================
# CONNECTION SETTINGS
# =============================================================================

# Maximum number of client connections
# Should match HikariCP max pool size + buffer for admin connections
max_connections = 100

# Reserved connections for superuser
superuser_reserved_connections = 3

# =============================================================================
# QUERY PLANNER SETTINGS
# =============================================================================

# random_page_cost: Cost of non-sequential disk access
# Set to 1.1 for SSD, 4.0 for HDD
random_page_cost = 1.1

# effective_io_concurrency: Number of concurrent disk operations
# Set to 200 for SSD, 2 for HDD
effective_io_concurrency = 200

# =============================================================================
# WRITE-AHEAD LOGGING (WAL)
# =============================================================================

# wal_buffers: Memory for WAL data before writing to disk
wal_buffers = 16MB

# checkpoint_completion_target: Spread checkpoint I/O
checkpoint_completion_target = 0.9

# max_wal_size: Maximum WAL size before checkpoint
max_wal_size = 1GB

# min_wal_size: Minimum WAL size to retain
min_wal_size = 80MB

# =============================================================================
# QUERY TUNING
# =============================================================================

# default_statistics_target: Number of histogram entries
# Higher = better plans but slower ANALYZE
default_statistics_target = 100

# =============================================================================
# LOGGING (for development/debugging)
# =============================================================================

# Log slow queries (>1 second)
log_min_duration_statement = 1000

# Log checkpoints
log_checkpoints = on

# Log lock waits
log_lock_waits = on

# =============================================================================
# AUTOVACUUM SETTINGS
# =============================================================================

# Enable autovacuum
autovacuum = on

# Run autovacuum more frequently for write-heavy tables
autovacuum_naptime = 60
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50
autovacuum_vacuum_scale_factor = 0.1
autovacuum_analyze_scale_factor = 0.05

# =============================================================================
# PRODUCTION SETTINGS (8GB+ RAM)
# Uncomment these for production deployment with 8GB+ RAM
# =============================================================================

# shared_buffers = 2GB
# effective_cache_size = 6GB
# work_mem = 32MB
# maintenance_work_mem = 512MB
# max_connections = 200

# =============================================================================
# VERIFICATION QUERIES
# Run these after applying settings to verify they took effect
# =============================================================================
#
# SHOW shared_buffers;
# SHOW effective_cache_size;
# SHOW work_mem;
# SHOW max_connections;
# SHOW random_page_cost;
#
# Check memory usage:
# SELECT pg_size_pretty(pg_database_size('civildesk'));
#
# Check current connections:
# SELECT count(*) FROM pg_stat_activity;
#
# Check slow queries:
# SELECT * FROM pg_stat_statements ORDER BY total_time DESC LIMIT 10;
# =============================================================================

